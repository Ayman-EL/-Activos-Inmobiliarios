<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Calculadora de Depreciaci√≥n Mejorada</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 20px auto; padding: 20px; background-color: #f9f9f9; }
        .section { background: white; padding: 25px; margin-bottom: 30px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        input, select { padding: 10px; margin: 10px; width: 220px; border: 2px solid #ddd; border-radius: 6px; }
        button { background: #4CAF50; color: white; padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #45a049; }
        .chart-container { margin: 30px 0; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; }
        th, td { padding: 15px; border: 1px solid #eee; text-align: center; }
        th { background: #f8f9fa; }
        .highlight { background: #e8f5e9 !important; }
        .back-button { margin-top: 20px; display: inline-block; background: #ccc; color: #333; padding: 8px 15px; border-radius: 6px; text-decoration: none; }
        .info-box { background: #e3f2fd; padding: 15px; border-left: 4px solid #2196F3; margin: 20px 0; }
        .two-columns { display: flex; gap: 20px; }
        .column { flex: 1; }
        @media (max-width: 768px) { .two-columns { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="section">
        <a href="renta_2.html" class="back-button">üè† Volver al inicio</a>
        <h2 style="color: #2c3e50; margin-bottom: 25px;">üìâ Calculadora Avanzada de Depreciaci√≥n</h2>
        
        <div class="two-columns">
            <div class="column">
                <h3 style="color: #2c3e50;">Datos B√°sicos</h3>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555;">Edad del inmueble (a√±os):</label>
                    <input type="number" id="edad" value="15" min="0" step="1">
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555;">Precio original (‚Ç¨):</label>
                    <input type="number" id="precio" value="300000" min="0" step="10000">
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555;">Tipo de construcci√≥n:</label>
                    <select id="tipoConstruccion">
                        <option value="ladrillo">Ladrillo/Mamposter√≠a</option>
                        <option value="hormigon">Hormig√≥n Armado</option>
                        <option value="metalica">Estructura Met√°lica</option>
                        <option value="madera">Madera</option>
                        <option value="mixta">Mixta (Hormig√≥n+Acero)</option>
                    </select>
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555;">Uso del inmueble:</label>
                    <select id="usoInmueble">
                        <option value="comercial">Comercial</option>
                        <option value="residencial">Residencial</option>
                        <option value="industrial">Industrial</option>
                        <option value="institucional">Institucional</option>
                    </select>
                </div>
            </div>
            <div class="column">
                <h3 style="color: #2c3e50;">Factores Espec√≠ficos</h3>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555;">Ubicaci√≥n:</label>
                    <select id="ubicacion">
                        <option value="costa">Costa (clima mar√≠timo)</option>
                        <option value="interior">Interior (clima continental)</option>                        <option value="montana">Monta√±a (clima extremo)</option>
                    </select>
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555;">Estado de conservaci√≥n:</label>
                    <select id="estado">
                        <option value="excelente">Excelente</option>
                        <option value="bueno">Bueno</option>
                        <option value="regular">Regular</option>
                        <option value="malo">Malo</option>
                    </select>
                </div>
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; color: #555;">¬øHa tenido rehabilitaciones?</label>
                    <select id="rehabilitacion">
                        <option value="si">S√≠</option>
                        <option value="no">No</option>
                    </select>
                </div>
            </div>
        </div>

        <button onclick="calcularDepreciacion()" style="margin-top: 15px;">üîç Calcular Depreciaci√≥n</button>


        <div id="resultados" style="margin-top: 30px;"></div>

        <div class="chart-container">
            <canvas id="valorChart"></canvas>
        </div>
    </div>

<script>
let valorChart = null;

const vidaUtil = {
    hormigon: { min: 50, max: 100 },
    ladrillo: { min: 50, max: 80 },
    metalica: { min: 30, max: 50 },
    madera: { min: 20, max: 30 },
    mixta: { min: 40, max: 60 }
};

function calcularDepreciacion() {
    const edadInput = parseFloat(document.getElementById('edad').value);
    const precioInput = parseFloat(document.getElementById('precio').value);
    const tipoConstruccion = document.getElementById("tipoConstruccion").value;
    const uso = document.getElementById("usoInmueble").value;
    const ubicacion = document.getElementById("ubicacion").value;
    const estado = document.getElementById("estado").value;
    const rehabilitacion = document.getElementById("rehabilitacion").value;

    if(isNaN(edadInput) || edadInput < 0 || isNaN(precioInput) || precioInput <= 0) {
        alert("‚ö†Ô∏è Por favor ingrese valores v√°lidos");
        return;
    }

    let vidaUtilBase = vidaUtil[tipoConstruccion].max;
    // 2. Aplicar factores de ajuste
    let factoresAplicados = [];

    if(ubicacion === "costa") {
        vidaUtilBase *= 0.8;  // Reduce 20% en zonas costeras
        factoresAplicados.push("Ubicaci√≥n costa (-20%)");
    } else if(ubicacion === "montana") {
        vidaUtilBase *= 0.9;  // Reduce 10% en zonas de monta√±a
        factoresAplicados.push("Ubicaci√≥n monta√±a (-10%)");
    }

    // Ajuste por estado
    if(estado === "regular") {
        vidaUtilBase *= 0.9;  // Reduce 10% para estado regular
        factoresAplicados.push("Estado regular (-10%)");
    } else if(estado === "malo") {
        vidaUtilBase *= 0.7;  // Reduce 30% para estado malo
        factoresAplicados.push("Estado malo (-30%)");
    }

    // Ajuste por rehabilitaciones
    if(rehabilitacion === "si") {
        vidaUtilBase *= 1.2;  // Aumenta 20% si tiene rehabilitaciones
        factoresAplicados.push("Con rehabilitaciones (+20%)");
    }
    
    // Redondeamos la vida √∫til a a√±os completos
    vidaUtilBase = Math.round(vidaUtilBase);

 // Calculamos el porcentaje de depreciaci√≥n anual
    const porcentajeDepreciacion = (1 / vidaUtilBase) * 100;

// Calculamos la depreciaci√≥n total acumulada
    const depreciacionTotal = (Math.min(edadInput, vidaUtilBase) / vidaUtilBase) * precioInput;
// Calculamos el valor actual
    const valorActual = Math.max(0, precioInput - depreciacionTotal);

    const html = `
        <h3 style="color: #2c3e50; margin-bottom: 20px;">üìä Resultados Detallados</h3>
        <div class="info-box">
            <h4 style="margin-top: 0; color: #2196F3;">Par√°metros utilizados</h4>
            <p><strong>Tipo de construcci√≥n:</strong> ${document.getElementById("tipoConstruccion").options[document.getElementById("tipoConstruccion").selectedIndex].text}</p>
            <p><strong>Uso del inmueble:</strong> ${document.getElementById("usoInmueble").options[document.getElementById("usoInmueble").selectedIndex].text}</p>
            <p><strong>Vida √∫til calculada:</strong> ${Math.round(vidaUtilBase)} a√±os (${porcentajeDepreciacion.toFixed(2)}% anual)</p>
        </div>
        <table>
            <tr>
                <th>Concepto</th>
                <th>Valor Inicial</th>
                <th>Valor Actual</th>
                <th>Depreciaci√≥n Total</th>
                <th>% Depreciado</th>
            </tr>
            <tr>
                <td>Inmueble</td>
                <td>${precioInput.toLocaleString('es-ES', {style: 'currency', currency: 'EUR'})}</td>
                <td class="highlight">${valorActual.toLocaleString('es-ES', {style: 'currency', currency: 'EUR'})}</td>
                <td>${depreciacionTotal.toLocaleString('es-ES', {style: 'currency', currency: 'EUR'})}</td>
                <td>${((depreciacionTotal/precioInput)*100).toFixed(2)}%</td>
            </tr>
        </table>
        <h4 style="margin-top: 25px; color: #555;">üìÖ Evoluci√≥n Anual del Valor</h4>
        <div class="chart-container">
            <canvas id="valorChart"></canvas>
        </div>
    `;
    
    document.getElementById('resultados').innerHTML = html;

    const ctx = document.getElementById('valorChart').getContext('2d');
    if(valorChart) valorChart.destroy();

    const historial = [];
    for(let year = 0; year <= Math.round(vidaUtilBase); year++) {
        const depreciacionAnual = (year / vidaUtilBase) * precioInput;
        const valorAnual = precioInput - depreciacionAnual;
        historial.push({
            a√±o: year,
            valor: valorAnual,
            depreciacionAnual: (year > 0) ? (valorAnual - historial[year-1].valor) : 0
        });
    }

    valorChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: historial.map(item => item.a√±o),
            datasets: [{
                label: 'Valor del Inmueble',
                data: historial.map(item => item.valor),
                borderColor: '#4CAF50',
                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                tension: 0.4,
                fill: true,
                pointRadius: 3,
                pointBackgroundColor: '#4CAF50'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                tooltip: {
                    callbacks: {
                        label: ctx => ` Valor: ${ctx.parsed.y.toLocaleString('es-ES', {style: 'currency', currency: 'EUR'})}`,
                        footer: ctx => `A√±o: ${ctx[0].label}`
                    }
                },
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    title: { display: true, text: 'Valor (‚Ç¨)', color: '#666' },
                    ticks: {
                        callback: value => `${(value/1000).toFixed(0)}k ‚Ç¨`,
                        color: '#666'
                    },
                    grid: { color: '#eee' }
                },
                x: {
                    title: { display: true, text: 'A√±os', color: '#666' },
                    grid: { display: false },
                    ticks: { color: '#666' }
                }
            }
        }
    });
}
</script>
</body>
</html>
